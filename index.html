<!-- FILE: index.html -->
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>VibeCode 2D-Kampfsimulator – Top-Down Layout</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- Phaser & Brython -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.0/dist/phaser.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/brython@3.11.3/brython.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/brython@3.11.3/brython_stdlib.js"></script>

  <style>
    html, body { margin:0; padding:0; background:#0e0e12; color:#eaeaf0; font-family:system-ui,Segoe UI,Roboto,Inter,Arial,Helvetica,sans-serif; height:100%; overflow:hidden; }
    #game-root { width:100vw; height:100vh; display:grid; place-items:center; }

    /* Top-Leiste */
    #ui-header {
      position:absolute; top:0; left:0; right:0; height:56px; z-index:20;
      background:#0b0b10; border-bottom:3px solid #0a0a0a; display:flex; align-items:center; justify-content:center;
    }
    #ui-header .title { font-weight:600; letter-spacing:.4px; margin:0 16px; }
    #ui-header .controls, #ui-header .tabs {
      position:absolute; display:flex; gap:8px; align-items:center;
    }
    #ui-header .controls { right:16px; top:8px; }
    #ui-header .tabs     { left:16px;  top:8px; }
    #ui-header button, #ui-header label, #ui-header input[type="checkbox"] {
      background:#14141c; color:#eaeaf0; border:1px solid #2b2b36; border-radius:8px; padding:6px 8px; font-size:12px;
    }
    #ui-header .tab { cursor:pointer; }
    #ui-header .tab.active { outline:2px solid #2f9bff; }

    /* Seitenpanels */
    .panel {
      position:absolute; top:56px; bottom:16px; width:260px; padding:12px; border-radius:12px; z-index:20;
      background:rgba(18,18,28,.78); border:2px solid #1fb6ff; box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset;
      overflow:auto;
    }
    #ui-left  { left:16px;  }
    #ui-right { right:16px; }
    .panel h2 { margin:0 0 10px 0; font-size:14px; color:#7ad7ff; text-align:center; }
    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:8px; }
    label { font-size:12px; opacity:.9; width:100%; }
    select, input[type="text"], input[type="number"], input[type="color"], input[type="range"] {
      background:#14141c; color:#eaeaf0; border:1px solid #2b2b36; border-radius:8px; padding:6px 8px; font-size:12px; width:100%;
    }
    .skills-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; width:100%; }
    .skill-btn { border:1px solid #2b2b36; border-radius:10px; padding:8px; background:#14141c; color:#eaeaf0; cursor:pointer; text-align:center; font-size:12px; user-select:none; }
    .skill-btn.active { box-shadow: 0 0 12px #66d1ff; border-color:#66d1ff; }

    .stat-bar { position:relative; width:100%; height:8px; background:#2b2b36; border-radius:4px; overflow:hidden; }
    .stat-bar .fill { position:absolute; top:0; left:0; height:100%; width:100%; background:#35de85; }
    .stat-bar.en .fill { background:#7ad7ff; }

    .center-grid { display:flex; flex-direction:column; gap:12px; }
    .section { border:1px solid #2b2b36; border-radius:10px; padding:10px; background:rgba(20,20,30,.65); }
    .section h3 { margin:0 0 8px 0; font-size:14px; color:#9cc9ff; }
    .row-inline { display:flex; gap:8px; align-items:center; }

    /* HUD-Fenster */
    #hud-window {
      position:absolute; top:80px; left:80px; min-width:200px;
      background:rgba(20,20,30,.9); border:1px solid #2b2b36;
      border-radius:8px; color:#b9c2ff; z-index:1000; display:none;
    }
    #hud-title {
      background:#0b0b10; cursor:move; padding:4px 8px; font-size:12px;
      border-bottom:1px solid #2b2b36;
    }
    #hud-content { padding:8px; font-size:12px; white-space:pre; }

    #footer-note { position:absolute; bottom:10px; left:12px; font-size:12px; opacity:.7; user-select:none; }

    /* Manager Mode Styles */
    .fighter-card {
      background:#1a1a24; border:1px solid #2b2b36; border-radius:8px; padding:8px; margin-bottom:8px; cursor:pointer;
      transition: all 0.2s;
    }
    .fighter-card:hover { border-color:#00aaff; background:#1e1e2a; }
    .fighter-card.selected { border-color:#00ff88; background:#1a2a1e; }
    .fighter-card .name { font-weight:600; font-size:13px; margin-bottom:4px; }
    .fighter-card .stats { font-size:11px; opacity:0.8; display:flex; gap:8px; flex-wrap:wrap; }
    .fighter-card .stat { background:#14141c; padding:2px 6px; border-radius:4px; }
    .fighter-card .color-badge { width:16px; height:16px; border-radius:50%; display:inline-block; margin-right:6px; vertical-align:middle; }

    .team-slot {
      background:#14141c; border:2px dashed #2b2b36; border-radius:8px; padding:10px; margin-bottom:8px;
      min-height:60px; cursor:pointer; transition: all 0.2s;
    }
    .team-slot:hover { border-color:#00aaff; }
    .team-slot .empty-slot { color:#666; font-size:11px; text-align:center; padding:10px; }
    .team-slot .fighter-info { display:flex; align-items:center; gap:8px; }
    .team-slot .fighter-info .name { font-size:12px; font-weight:600; }
    .team-slot .fighter-info .level { font-size:10px; opacity:0.7; }
    .team-slot.filled { border-style:solid; border-color:#00aaff; }

    /* Speed Control Buttons */
    .speed-btn {
      flex:1; padding:8px; background:#14141c; color:#eaeaf0; border:1px solid #2b2b36;
      border-radius:6px; cursor:pointer; font-size:12px; font-weight:600; transition: all 0.2s;
    }
    .speed-btn:hover { border-color:#00aaff; background:#1a1a24; }
    .speed-btn.active { background:#00aaff; color:#fff; border-color:#00aaff; }

    /* Item Management */
    .item-slot {
      flex:1; min-width:80px; background:#14141c; border:2px dashed #2b2b36; border-radius:6px;
      padding:6px; cursor:pointer; transition: all 0.2s; position:relative;
    }
    .item-slot:hover { border-color:#00aaff; }
    .item-slot.filled { border-style:solid; border-color:#00ff88; }
    .item-slot .empty-item-slot { color:#666; font-size:10px; text-align:center; }
    .item-slot .item-badge {
      font-size:9px; padding:4px; border-radius:4px; text-align:center;
      display:flex; flex-direction:column; gap:2px;
    }
    .item-slot .item-badge .item-name { font-weight:600; font-size:10px; }
    .item-slot .item-badge .item-type { opacity:0.6; font-size:8px; }
    .item-slot .unequip-btn {
      position:absolute; top:2px; right:2px; background:#ff4444; color:white;
      border:none; border-radius:4px; width:16px; height:16px; font-size:10px;
      cursor:pointer; display:none; padding:0; line-height:16px;
    }
    .item-slot.filled:hover .unequip-btn { display:block; }

    .item-card {
      background:#1a1a24; border:1px solid #2b2b36; border-radius:6px; padding:6px;
      cursor:pointer; transition: all 0.2s;
    }
    .item-card:hover { border-color:#00aaff; background:#1e1e2a; }
    .item-card.equipped { opacity:0.4; pointer-events:none; }
    .item-card .item-header {
      display:flex; align-items:center; gap:6px; margin-bottom:4px;
    }
    .item-card .item-icon {
      width:24px; height:24px; border-radius:4px; flex-shrink:0;
    }
    .item-card .item-name { font-weight:600; font-size:11px; flex:1; }
    .item-card .item-slot-type {
      font-size:9px; opacity:0.5; background:#14141c; padding:2px 4px; border-radius:3px;
    }
    .item-card .item-desc { font-size:10px; opacity:0.7; line-height:1.3; }
    .item-card.rarity-common { border-left-color:#888; }
    .item-card.rarity-uncommon { border-left-color:#00ff88; }
    .item-card.rarity-rare { border-left-color:#00aaff; }
    .item-card.rarity-epic { border-left-color:#ff00ff; }
  </style>

  <!-- Namespaces -->
  <script>
    window.Engine = window.Engine || {};
    window.Scenes = window.Scenes || {};
    window.GameBridge = window.GameBridge || {};
    window.GameData = window.GameData || { characters:[] };
  </script>
</head>
<body onload="brython()">
  <div id="game-root"></div>

  <!-- HAUPT MENU -->
  <div id="ui-header">
    <div class="tabs">
      <button class="tab" id="tab-manager">Manager</button>
      <button class="tab active" id="tab-sim">Simulator</button>
      <button class="tab" id="tab-char">Char. Creator</button>
      <button class="tab" id="tab-skill">Skill Creator</button>
      <button class="tab" id="tab-ai">KI Creator</button>
    </div>
    <div class="title">Haupt Menu</div>
    <div class="controls">
      <button id="btn-start">Neustart Match</button>
      <label style="display:flex;gap:6px;align-items:center;"><input type="checkbox" id="toggle-ki-brython" checked/> Brython-KI</label>
      <label style="display:flex;gap:6px;align-items:center;"><input type="checkbox" id="toggle-hitboxes"/> Hitboxen</label>
        <label style="display:flex;gap:6px;align-items:center;"><input type="checkbox" id="toggle-debug"/> Debug</label>
      </div>
    </div>

  <!-- HUD-Fenster -->
  <div id="hud-window">
    <div id="hud-title">Debug HUD</div>
    <pre id="hud-content"></pre>
  </div>

  <!-- SEITENPANELS -->
  <div id="ui-left" class="panel">
    <div id="panel-sim-left">
      <h2>Team Blue (2 Kämpfer)</h2>
      <div class="section" style="margin-bottom:12px;">
        <h3 style="margin:0 0 6px 0; font-size:12px; color:#7ad7ff;">Fighter 1</h3>
        <div class="row"><label style="font-size:11px;">HP</label><div class="stat-bar"><div id="t1f1-hp-fill" class="fill"></div></div></div>
        <div class="row"><label style="font-size:11px;">EN</label><div class="stat-bar en"><div id="t1f1-en-fill" class="fill"></div></div></div>
      </div>
      <div class="section">
        <h3 style="margin:0 0 6px 0; font-size:12px; color:#7ad7ff;">Fighter 2</h3>
        <div class="row"><label style="font-size:11px;">HP</label><div class="stat-bar"><div id="t1f2-hp-fill" class="fill"></div></div></div>
        <div class="row"><label style="font-size:11px;">EN</label><div class="stat-bar en"><div id="t1f2-en-fill" class="fill"></div></div></div>
      </div>
      <div class="row" style="margin-top:12px;"><label for="p1ai">Team Profil</label>
        <select id="p1ai">
          <option value="aggressive">aggressiv</option>
          <option value="defensive">defensiv</option>
          <option value="random">random</option>
        </select>
      </div>

      <div class="section" style="margin-top:16px;">
        <h3>Match Speed</h3>
        <div style="display:flex; gap:8px;">
          <button class="speed-btn" data-speed="1">1x</button>
          <button class="speed-btn active" data-speed="2">2x</button>
          <button class="speed-btn" data-speed="4">4x</button>
        </div>
      </div>
    </div>

    <div id="panel-char-left" style="display:none;">
      <div class="center-grid">
        <div class="section">
          <h3>Charakter wählen / laden</h3>
          <div class="row"><label>Vorlage</label><select id="cc-load"></select></div>
          <div class="row-inline">
            <button id="cc-new">Neu</button>
            <button id="cc-duplicate">Duplizieren</button>
            <button id="cc-delete">Löschen</button>
          </div>
        </div>
        <div class="section">
          <h3>Aktionen</h3>
          <div class="row-inline">
            <button id="cc-save">Speichern</button>
            <button id="cc-use-p1">Als P1 nutzen</button>
            <button id="cc-use-p2">Als P2 nutzen</button>
            <button id="cc-export">Export JSON</button>
          </div>
          <small>Speichern legt/aktualisiert den Charakter in der Datenbank (auch localStorage). „Nutzen“ startet sofort ein Match.</small>
        </div>
      </div>
    </div>

    <div id="panel-manager-left" style="display:none;">
      <h2>Fighter Roster</h2>
      <div style="font-size:10px; opacity:0.5; margin-bottom:8px;">1x Klick = Team hinzufügen | 2x Klick = Items verwalten</div>
      <div id="roster-list" style="max-height:280px; overflow-y:auto; margin-bottom:16px;">
        <!-- Fighter cards will be added here dynamically -->
      </div>

      <div class="section" id="item-manager-section" style="display:none;">
        <h3 style="margin:0 0 8px 0;">Equipment - <span id="selected-fighter-name">---</span></h3>

        <!-- Equipped Items -->
        <div style="margin-bottom:12px;">
          <div style="font-size:10px; opacity:0.6; margin-bottom:4px;">EQUIPPED</div>
          <div id="equipped-slots" style="display:flex; gap:6px; flex-wrap:wrap;">
            <div class="item-slot" data-slot="0">
              <div class="empty-item-slot">Slot 1</div>
            </div>
            <div class="item-slot" data-slot="1">
              <div class="empty-item-slot">Slot 2</div>
            </div>
            <div class="item-slot" data-slot="2">
              <div class="empty-item-slot">Slot 3</div>
            </div>
          </div>
        </div>

        <!-- Available Items -->
        <div>
          <div style="font-size:10px; opacity:0.6; margin-bottom:4px;">AVAILABLE ITEMS</div>
          <div id="available-items" style="max-height:200px; overflow-y:auto; display:flex; flex-direction:column; gap:4px;">
            <!-- Item cards will be added here dynamically -->
          </div>
        </div>
      </div>
    </div>
    <div id="panel-skill-left" style="display:none;">
      <div class="section"><h3>Skill Creator</h3><p>Platzhalter.</p></div>
    </div>
    <div id="panel-ai-left" style="display:none;">
      <div class="section"><h3>KI Creator</h3><p>Platzhalter.</p></div>
    </div>
  </div>

  <div id="ui-right" class="panel">
    <div id="panel-sim-right">
      <h2>Team Red (2 Kämpfer)</h2>
      <div class="section" style="margin-bottom:12px;">
        <h3 style="margin:0 0 6px 0; font-size:12px; color:#ff9b7a;">Fighter 1</h3>
        <div class="row"><label style="font-size:11px;">HP</label><div class="stat-bar"><div id="t2f1-hp-fill" class="fill"></div></div></div>
        <div class="row"><label style="font-size:11px;">EN</label><div class="stat-bar en"><div id="t2f1-en-fill" class="fill"></div></div></div>
      </div>
      <div class="section">
        <h3 style="margin:0 0 6px 0; font-size:12px; color:#ff9b7a;">Fighter 2</h3>
        <div class="row"><label style="font-size:11px;">HP</label><div class="stat-bar"><div id="t2f2-hp-fill" class="fill"></div></div></div>
        <div class="row"><label style="font-size:11px;">EN</label><div class="stat-bar en"><div id="t2f2-en-fill" class="fill"></div></div></div>
      </div>
      <div class="row" style="margin-top:12px;"><label for="p2ai">Team Profil</label>
        <select id="p2ai">
          <option value="defensive">defensiv</option>
          <option value="aggressive">aggressiv</option>
          <option value="random">random</option>
        </select>
      </div>
    </div>

    <div id="panel-char-right" style="display:none;">
      <div class="center-grid">
        <div class="section">
          <h3>Basisdaten</h3>
          <div class="row"><label>Name</label><input id="cc-name" type="text" placeholder="z. B. Nova"/></div>
          <div class="row-inline" style="width:100%;">
            <div style="flex:1">
              <label>Form</label>
              <select id="cc-shape"><option value="circle">Kreis</option><option value="square">Quadrat</option><option value="triangle">Dreieck</option></select>
            </div>
            <div style="width:120px">
              <label>Farbe</label><input id="cc-color" type="color" value="#64c8ff"/>
            </div>
          </div>
          <div class="row"><label>Radius</label><input id="cc-radius" type="range" min="14" max="36" value="22"/></div>
        </div>

        <div class="section">
          <h3>Stats</h3>
          <div class="row-inline"><label style="width:100px">HP</label><input id="cc-maxhp" type="number" value="120"/></div>
          <div class="row-inline"><label style="width:100px">EN</label><input id="cc-maxen" type="number" value="100"/></div>
          <div class="row-inline"><label style="width:100px">Accel</label><input id="cc-accel" type="number" value="1800"/></div>
          <div class="row-inline"><label style="width:100px">Speed</label><input id="cc-speed" type="number" value="240"/></div>
          <div class="row-inline"><label style="width:100px">Dash</label><input id="cc-dash" type="number" value="560"/></div>
          <div class="row-inline"><label style="width:100px">Friction</label><input id="cc-fric" type="number" step="0.01" value="0.86"/></div>
          <div class="row-inline"><label style="width:100px">PhysAtk</label><input id="cc-physatk" type="number" step="0.1" value="1"/></div>
          <div class="row-inline"><label style="width:100px">EnAtk</label><input id="cc-enatk" type="number" step="0.1" value="1"/></div>
          <div class="row-inline"><label style="width:100px">AtkSpd</label><input id="cc-atkspd" type="number" step="0.1" value="1"/></div>
          <div class="row-inline"><label style="width:100px">CastSpd</label><input id="cc-castspd" type="number" step="0.1" value="1"/></div>
          <div class="row-inline"><label style="width:100px">ChanSpd</label><input id="cc-chanspd" type="number" step="0.1" value="1"/></div>
          <div class="row-inline"><label style="width:100px">PhysRange</label><input id="cc-physrng" type="number" step="0.1" value="1"/></div>
          <div class="row-inline"><label style="width:100px">EnRange</label><input id="cc-enrng" type="number" step="0.1" value="1"/></div>
          <div class="row-inline"><label style="width:100px">PhysDef</label><input id="cc-physdef" type="number" step="0.1" value="0"/></div>
          <div class="row-inline"><label style="width:100px">EnDef</label><input id="cc-endef" type="number" step="0.1" value="0"/></div>
          <div class="row-inline"><label style="width:100px">HPRegen</label><input id="cc-hpreg" type="number" step="0.1" value="0"/></div>
          <div class="row-inline"><label style="width:100px">EnRegen</label><input id="cc-enreg" type="number" step="0.1" value="0"/></div>
          <div class="row-inline"><label style="width:100px">SkillSlots</label><input id="cc-slots" type="number" value="4"/></div>
          <div class="row-inline"><label style="width:100px">Special</label><input id="cc-special" type="text"/></div>
          <div class="row-inline"><label style="width:100px">SE Power</label><input id="cc-stapow" type="number" step="0.1" value="0"/></div>
          <div class="row-inline"><label style="width:100px">SE Dur</label><input id="cc-stadur" type="number" step="0.1" value="1"/></div>
          <div class="row-inline"><label style="width:100px">SE Resist</label><input id="cc-stares" type="number" step="0.1" value="0"/></div>
          <div class="row-inline"><label style="width:100px">SE DurRes</label><input id="cc-stadurres" type="number" step="0.1" value="1"/></div>
        </div>

        <div class="section" style="grid-column: 1 / span 2;">
          <h3>Skill-Loadout</h3>
          <div class="row-inline" style="flex-wrap:wrap">
            <label style="width:auto"><input type="checkbox" id="cc-skill-light" checked/> Light</label>
            <label style="width:auto"><input type="checkbox" id="cc-skill-heavy" checked/> Heavy</label>
            <label style="width:auto"><input type="checkbox" id="cc-skill-spin"  checked/> Spin</label>
            <label style="width:auto"><input type="checkbox" id="cc-skill-heal"  checked/> Heal</label>
          </div>
        </div>
      </div>
    </div>

    <div id="panel-manager-right" style="display:none;">
      <h2>Team Setup</h2>

      <div class="section" style="margin-bottom:16px;">
        <h3 style="color:#66d9ff;">Team 1 (Blue)</h3>
        <div id="team1-slot1" class="team-slot" data-team="1" data-slot="0">
          <div class="empty-slot">Klick Fighter links zum Hinzufügen</div>
        </div>
        <div id="team1-slot2" class="team-slot" data-team="1" data-slot="1">
          <div class="empty-slot">Klick Fighter links zum Hinzufügen</div>
        </div>
      </div>

      <div class="section" style="margin-bottom:16px;">
        <h3 style="color:#ff9b7a;">Team 2 (Red)</h3>
        <div id="team2-slot1" class="team-slot" data-team="2" data-slot="0">
          <div class="empty-slot">Klick Fighter links zum Hinzufügen</div>
        </div>
        <div id="team2-slot2" class="team-slot" data-team="2" data-slot="1">
          <div class="empty-slot">Klick Fighter links zum Hinzufügen</div>
        </div>
      </div>

      <button id="btn-start-manager-match" style="width:100%; padding:12px; font-size:14px; background:#00aaff; color:white; border:none; border-radius:8px; cursor:pointer; margin-top:8px;">
        Start Match
      </button>

      <div id="match-results" style="display:none; margin-top:16px;" class="section">
        <h3>Match Ergebnis</h3>
        <div id="result-content"></div>
        <button id="btn-back-to-roster" style="width:100%; padding:10px; margin-top:12px; background:#2b2b36; color:white; border:1px solid #00aaff; border-radius:8px; cursor:pointer;">
          Zurück zum Roster
        </button>
      </div>
    </div>
    <div id="panel-skill-right" style="display:none;">
      <div class="section"><h3>Skill Creator</h3><p>Platzhalter.</p></div>
    </div>
    <div id="panel-ai-right" style="display:none;">
      <div class="section"><h3>KI Creator</h3><p>Platzhalter.</p></div>
    </div>
  </div>

  <div id="footer-note">Run: lokaler Server erforderlich – siehe Anleitung unten.</div>

  <!-- Engine & Scenes -->
  <script src="js/engine/FeelSystem.js"></script>
  <script src="js/engine/HitboxSystem.js"></script>
  <script src="js/engine/InputSystem.js"></script>
  <script src="js/engine/Fighter.js"></script>
  <script src="js/engine/Team.js"></script>

  <script src="js/scenes/BootScene.js"></script>
  <script src="js/scenes/PreloadScene.js"></script>
  <script src="js/scenes/FightScene.js"></script>

  <script src="js/main.js"></script>

  <!-- Brython KI-Profile -->
  <script type="text/python" src="py/ai.py"></script>
</body>
</html>
