<!-- FILE: index.html -->
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>VibeCode 2D-Kampfsimulator – Top-Down Layout</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- Phaser & Brython -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.0/dist/phaser.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/brython@3.11.3/brython.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/brython@3.11.3/brython_stdlib.js"></script>

  <style>
    html, body { margin:0; padding:0; background:#0e0e12; color:#eaeaf0; font-family:system-ui,Segoe UI,Roboto,Inter,Arial,Helvetica,sans-serif; height:100%; overflow:hidden; }
    #game-root { width:100vw; height:100vh; display:grid; place-items:center; }

    /* Top-Leiste */
    #ui-header {
      position:absolute; top:0; left:0; right:0; height:56px; z-index:20;
      background:#0b0b10; border-bottom:3px solid #0a0a0a; display:flex; align-items:center; justify-content:center;
    }
    #ui-header .title { font-weight:600; letter-spacing:.4px; margin:0 16px; }
    #ui-header .controls, #ui-header .tabs {
      position:absolute; display:flex; gap:8px; align-items:center;
    }
    #ui-header .controls { right:16px; top:8px; }
    #ui-header .tabs     { left:16px;  top:8px; }
    #ui-header button, #ui-header label, #ui-header input[type="checkbox"] {
      background:#14141c; color:#eaeaf0; border:1px solid #2b2b36; border-radius:8px; padding:6px 8px; font-size:12px;
    }
    #ui-header .tab { cursor:pointer; }
    #ui-header .tab.active { outline:2px solid #2f9bff; }

    /* Seitenpanels */
    .panel {
      position:absolute; top:56px; bottom:16px; width:260px; padding:12px; border-radius:12px; z-index:20;
      background:rgba(18,18,28,.78); border:2px solid #1fb6ff; box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset;
      overflow:auto;
    }
    #ui-left  { left:16px;  }
    #ui-right { right:16px; }
    .panel h2 { margin:0 0 10px 0; font-size:14px; color:#7ad7ff; text-align:center; }
    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:8px; }
    label { font-size:12px; opacity:.9; width:100%; }
    select, input[type="text"], input[type="number"], input[type="color"], input[type="range"] {
      background:#14141c; color:#eaeaf0; border:1px solid #2b2b36; border-radius:8px; padding:6px 8px; font-size:12px; width:100%;
    }
    progress { width:100%; height:12px; }
    .skills-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; width:100%; }
    .skill-btn { border:1px solid #2b2b36; border-radius:10px; padding:8px; background:#14141c; color:#eaeaf0; cursor:pointer; text-align:center; font-size:12px; user-select:none; }
    .skill-btn.active { box-shadow: 0 0 12px #66d1ff; border-color:#66d1ff; }

    .center-grid { display:flex; flex-direction:column; gap:12px; }
    .section { border:1px solid #2b2b36; border-radius:10px; padding:10px; background:rgba(20,20,30,.65); }
    .section h3 { margin:0 0 8px 0; font-size:14px; color:#9cc9ff; }
    .row-inline { display:flex; gap:8px; align-items:center; }

    /* HUD-Fenster */
    #hud-window {
      position:absolute; top:80px; left:80px; min-width:200px;
      background:rgba(20,20,30,.9); border:1px solid #2b2b36;
      border-radius:8px; color:#b9c2ff; z-index:1000; display:none;
    }
    #hud-title {
      background:#0b0b10; cursor:move; padding:4px 8px; font-size:12px;
      border-bottom:1px solid #2b2b36;
    }
    #hud-content { padding:8px; font-size:12px; white-space:pre; }

    #footer-note { position:absolute; bottom:10px; left:12px; font-size:12px; opacity:.7; user-select:none; }
  </style>

  <!-- Namespaces -->
  <script>
    window.Engine = window.Engine || {};
    window.Scenes = window.Scenes || {};
    window.GameBridge = window.GameBridge || {};
    window.GameData = window.GameData || { characters:[] };
  </script>
</head>
<body onload="brython()">
  <div id="game-root"></div>

  <!-- HAUPT MENU -->
  <div id="ui-header">
    <div class="tabs">
      <button class="tab active" id="tab-sim">Simulator</button>
      <button class="tab" id="tab-story">Story</button>
      <button class="tab" id="tab-char">Char. Creator</button>
      <button class="tab" id="tab-skill">Skill Creator</button>
      <button class="tab" id="tab-ai">KI Creator</button>
    </div>
    <div class="title">Haupt Menu</div>
    <div class="controls">
      <button id="btn-start">Neustart Match</button>
      <label style="display:flex;gap:6px;align-items:center;"><input type="checkbox" id="toggle-ki-brython" checked/> Brython-KI</label>
      <label style="display:flex;gap:6px;align-items:center;"><input type="checkbox" id="toggle-hitboxes"/> Hitboxen</label>
        <label style="display:flex;gap:6px;align-items:center;"><input type="checkbox" id="toggle-debug"/> Debug</label>
      </div>
    </div>

  <!-- HUD-Fenster -->
  <div id="hud-window">
    <div id="hud-title">Debug HUD</div>
    <pre id="hud-content"></pre>
  </div>

  <!-- SEITENPANELS -->
  <div id="ui-left" class="panel">
    <div id="panel-sim-left">
      <h2>Panel 1 • Spieler 1 (KI)</h2>
      <div class="row"><label for="p1char">Charakter</label><select id="p1char"></select></div>
      <div class="row"><label for="p1ai">Profil</label>
        <select id="p1ai">
          <option value="aggressive">aggressiv</option>
          <option value="defensive">defensiv</option>
          <option value="random">random</option>
        </select>
      </div>
      <div class="row"><label>Skills</label>
        <div class="skills-grid">
          <div id="p1-skill-light"  class="skill-btn" data-side="P1" data-skill="light">Light</div>
          <div id="p1-skill-heavy"  class="skill-btn" data-side="P1" data-skill="heavy">Heavy</div>
          <div id="p1-skill-spin"   class="skill-btn" data-side="P1" data-skill="spin">Spin</div>
          <div id="p1-skill-heal"   class="skill-btn" data-side="P1" data-skill="heal">Heal</div>
        </div>
      </div>
      <div class="row"><label>HP</label><progress id="p1-hp" value="0" max="100" style="width:100%"></progress></div>
      <div class="row"><label>EN</label><progress id="p1-en" value="0" max="100" style="width:100%"></progress></div>
    </div>

    <div id="panel-char-left" style="display:none;">
      <div class="center-grid">
        <div class="section">
          <h3>Charakter wählen / laden</h3>
          <div class="row"><label>Vorlage</label><select id="cc-load"></select></div>
          <div class="row-inline">
            <button id="cc-new">Neu</button>
            <button id="cc-duplicate">Duplizieren</button>
            <button id="cc-delete">Löschen</button>
          </div>
        </div>
        <div class="section">
          <h3>Aktionen</h3>
          <div class="row-inline">
            <button id="cc-save">Speichern</button>
            <button id="cc-use-p1">Als P1 nutzen</button>
            <button id="cc-use-p2">Als P2 nutzen</button>
            <button id="cc-export">Export JSON</button>
          </div>
          <small>Speichern legt/aktualisiert den Charakter in der Datenbank (auch localStorage). „Nutzen“ startet sofort ein Match.</small>
        </div>
      </div>
    </div>

    <div id="panel-story-left" style="display:none;">
      <div class="section"><h3>Story</h3><p>Platzhalter.</p></div>
    </div>
    <div id="panel-skill-left" style="display:none;">
      <div class="section"><h3>Skill Creator</h3><p>Platzhalter.</p></div>
    </div>
    <div id="panel-ai-left" style="display:none;">
      <div class="section"><h3>KI Creator</h3><p>Platzhalter.</p></div>
    </div>
  </div>

  <div id="ui-right" class="panel">
    <div id="panel-sim-right">
      <h2>Panel 2 • Spieler 2 (KI)</h2>
      <div class="row"><label for="p2char">Charakter</label><select id="p2char"></select></div>
      <div class="row"><label for="p2ai">Profil</label>
        <select id="p2ai">
          <option value="defensive">defensiv</option>
          <option value="aggressive">aggressiv</option>
          <option value="random">random</option>
        </select>
      </div>
      <div class="row"><label>Skills</label>
        <div class="skills-grid">
          <div id="p2-skill-light"  class="skill-btn" data-side="P2" data-skill="light">Light</div>
          <div id="p2-skill-heavy"  class="skill-btn" data-side="P2" data-skill="heavy">Heavy</div>
          <div id="p2-skill-spin"   class="skill-btn" data-side="P2" data-skill="spin">Spin</div>
          <div id="p2-skill-heal"   class="skill-btn" data-side="P2" data-skill="heal">Heal</div>
        </div>
      </div>
      <div class="row"><label>HP</label><progress id="p2-hp" value="0" max="100" style="width:100%"></progress></div>
      <div class="row"><label>EN</label><progress id="p2-en" value="0" max="100" style="width:100%"></progress></div>
    </div>

    <div id="panel-char-right" style="display:none;">
      <div class="center-grid">
        <div class="section">
          <h3>Basisdaten</h3>
          <div class="row"><label>Name</label><input id="cc-name" type="text" placeholder="z. B. Nova"/></div>
          <div class="row-inline" style="width:100%;">
            <div style="flex:1">
              <label>Form</label>
              <select id="cc-shape"><option value="circle">Kreis</option><option value="square">Quadrat</option><option value="triangle">Dreieck</option></select>
            </div>
            <div style="width:120px">
              <label>Farbe</label><input id="cc-color" type="color" value="#64c8ff"/>
            </div>
          </div>
          <div class="row"><label>Radius</label><input id="cc-radius" type="range" min="14" max="36" value="22"/></div>
        </div>

        <div class="section">
          <h3>Stats</h3>
          <div class="row-inline"><label style="width:100px">HP</label><input id="cc-maxhp" type="number" value="120"/></div>
          <div class="row-inline"><label style="width:100px">EN</label><input id="cc-maxen" type="number" value="100"/></div>
          <div class="row-inline"><label style="width:100px">Phys ATK</label><input id="cc-physatk" type="number" step="0.1" value="1"/></div>
          <div class="row-inline"><label style="width:100px">EN ATK</label><input id="cc-enatk" type="number" step="0.1" value="1"/></div>
          <div class="row-inline"><label style="width:100px">Atk Spd</label><input id="cc-atkspeed" type="number" step="0.1" value="1"/></div>
          <div class="row-inline"><label style="width:100px">Cast Spd</label><input id="cc-castspeed" type="number" step="0.1" value="1"/></div>
          <div class="row-inline"><label style="width:100px">Channel Spd</label><input id="cc-channelspeed" type="number" step="0.1" value="1"/></div>
          <div class="row-inline"><label style="width:100px">Phys Range</label><input id="cc-physrange" type="number" step="0.1" value="1"/></div>
          <div class="row-inline"><label style="width:100px">EN Range</label><input id="cc-energyrange" type="number" step="0.1" value="1"/></div>
          <div class="row-inline"><label style="width:100px">Accel</label><input id="cc-accel" type="number" value="1800"/></div>
          <div class="row-inline"><label style="width:100px">Move Spd</label><input id="cc-speed" type="number" value="240"/></div>
          <div class="row-inline"><label style="width:100px">Dash</label><input id="cc-dash" type="number" value="560"/></div>
          <div class="row-inline"><label style="width:100px">Friction</label><input id="cc-fric" type="number" step="0.01" value="0.86"/></div>
          <div class="row-inline"><label style="width:100px">Phys Def</label><input id="cc-physdef" type="number" step="0.1" value="0"/></div>
          <div class="row-inline"><label style="width:100px">EN Def</label><input id="cc-enedef" type="number" step="0.1" value="0"/></div>
          <div class="row-inline"><label style="width:100px">HP Regen</label><input id="cc-hpregen" type="number" step="0.1" value="0"/></div>
          <div class="row-inline"><label style="width:100px">EN Regen</label><input id="cc-enregen" type="number" step="0.1" value="0"/></div>
          <div class="row-inline"><label style="width:100px">Skill Slots</label><input id="cc-skillslots" type="number" value="4"/></div>
          <div class="row-inline"><label style="width:100px">Spezial</label><input id="cc-special" type="text" value=""/></div>
          <div class="row-inline"><label style="width:100px">Status Power</label><input id="cc-statuspower" type="number" step="0.1" value="0"/></div>
          <div class="row-inline"><label style="width:100px">Status Dauer</label><input id="cc-statusduration" type="number" step="0.1" value="1"/></div>
          <div class="row-inline"><label style="width:100px">Status Resist</label><input id="cc-statusresist" type="number" step="0.1" value="0"/></div>
          <div class="row-inline"><label style="width:100px">StatusDurRes</label><input id="cc-statusdurresist" type="number" step="0.1" value="0"/></div>
        </div>

        <div class="section" style="grid-column: 1 / span 2;">
          <h3>Skill-Loadout</h3>
          <div class="row-inline" style="flex-wrap:wrap">
            <label style="width:auto"><input type="checkbox" id="cc-skill-light" checked/> Light</label>
            <label style="width:auto"><input type="checkbox" id="cc-skill-heavy" checked/> Heavy</label>
            <label style="width:auto"><input type="checkbox" id="cc-skill-spin"  checked/> Spin</label>
            <label style="width:auto"><input type="checkbox" id="cc-skill-heal"  checked/> Heal</label>
          </div>
        </div>
      </div>
    </div>

    <div id="panel-story-right" style="display:none;">
      <div class="section"><h3>Story</h3><p>Platzhalter.</p></div>
    </div>
    <div id="panel-skill-right" style="display:none;">
      <div class="section"><h3>Skill Creator</h3><p>Platzhalter.</p></div>
    </div>
    <div id="panel-ai-right" style="display:none;">
      <div class="section"><h3>KI Creator</h3><p>Platzhalter.</p></div>
    </div>
  </div>

  <div id="footer-note">Run: lokaler Server erforderlich – siehe Anleitung unten.</div>

  <!-- Engine & Scenes -->
  <script src="js/engine/FeelSystem.js"></script>
  <script src="js/engine/HitboxSystem.js"></script>
  <script src="js/engine/InputSystem.js"></script>
  <script src="js/engine/Fighter.js"></script>

  <script src="js/scenes/BootScene.js"></script>
  <script src="js/scenes/PreloadScene.js"></script>
  <script src="js/scenes/FightScene.js"></script>

  <script src="js/main.js"></script>

  <!-- Brython KI-Profile -->
  <script type="text/python" src="py/ai.py"></script>
</body>
</html>
